CREATE TABLE mrole (id BIGINT PRIMARY KEY, name VARCHAR(256), subjects BIGINT ARRAY, comment VARCHAR(256));
CREATE TABLE uisubject (id BIGINT PRIMARY KEY, name VARCHAR(256), extension VARCHAR(256) ARRAY);
ALTER TABLE muser ADD COLUMN roles BIGINT ARRAY;	
CREATE SEQUENCE rbac_id_seq START WITH 1 INCREMENT BY 1;

CREATE PROCEDURE rbac_seq_nextval ( OUT out_id BIGINT)
 MODIFIES SQL DATA
  BEGIN ATOMIC
    SELECT NEXT VALUE FOR rbac_id_seq into out_id FROM muser where muser.id = 1; -- #1399 Cannot assign sequence value to a variable in a stored procedure
  END;

DROP FUNCTION array_append IF EXISTS;
CREATE FUNCTION array_append (arr BIGINT ARRAY, val BIGINT) RETURNS BIGINT ARRAY
   RETURN CASE WHEN arr = NULL THEN ARRAY[val] ELSE CONCAT(arr, ARRAY[val]) END CASE;

-- CREATE TABLE MUSER_TO_BRANCH (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, branch_id BIGINT);
-- CREATE TABLE BRANCH_UNITS (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, name VARCHAR(256), ldap VARCHAR(256) ARRAY);
-- CREATE TABLE BRANCH_CHILD (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, child_id BIGINT);
-- CREATE TABLE MAGENT_TO_BRANCH (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, branch_id BIGINT);
