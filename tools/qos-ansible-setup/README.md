# Установка pgpool и postgres

## Подготовка

Предварительные  действия необходимо  делать на  CentOS для  создания локального
репозитория. На этом шаге необходим доступ в интернет и root доступ:

```
$ sudo ./preparerepo.sh
```

Если CentOS под  рукой нету, то есть возможность запустить  виртуальную машину с
помощью   [vagrant](https://www.vagrantup.com)    с   автоматическим   постоение
репозитория:

```
$ vagrant up repo
```

Есть 2  вида разворачивания  системы: с  локальной машины  или с  удаленной. Оба
варианта не требуют доступа в интернет.

### Установка с локальной машины

Требования:

* Удаленный доступ к серверам по ssh с локальной машины
* Настроенный беспарольный доступ к серверам по ssh с локальной машины
* Root доступ на серверах
* Установленный        ansible.          Можно        ознакомиться        здесь:
  http://docs.ansible.com/ansible/intro_installation.html

Смотри дальнейшие действия в главе про запуск.

### Установка с удаленной машины

Требования:

* Удаленный доступ к серверам по ssh с удаленной машины на все сервера
* Настроенный беспарольный  доступ к серверам по  ssh с удаленной машины  (в том
  числе на эту же машину, если необходимо)
* Root доступ на серверах
* CentOS на удаленной машине

Для удобства  перемещения настроек созадем  архив. Для linux based  систем можно
воспользоваться   скриптом,  в   результате  действий   которого  будет   создан
`setup.tar.gz`:

```
$ ./archive.sh
```

Далее копируем архив на удаленную  машину любым удобным способом и распаковываем
в удобную папку. Устанавливаем ansible:

```
$ sudo ./install_ansible.sh
```

Смотри дальнейшие действия в главе про запуск.

## Запуск и настройка сети

Настраиваем  конфигурацию   сети.   Для   этого  есть   2  примера:   `hosts`  и
`prodlike_hosts`.   Можно  создать  новый  файл  или  отредактировать  указанные
примеры.                   Подробости                 смотри                  на
[сайте ansible](http://docs.ansible.com/ansible/intro_inventory.html)

Для запуска автоматической настройки запускаем ansible из папки с `all.yml`:

```
$ ansible-playbook -i <inventory_file> all.yml
```

, где `<inventory_file>` - файл с настройками сети. Например:

```
$ ansible-playbook -i hosts all.yml
```
